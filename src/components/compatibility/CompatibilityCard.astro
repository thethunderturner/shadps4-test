---
import {statusStyles} from './utils.tsx';
const {name, osStart} = Astro.props;

interface Props {
    osStart: {tag: string; count: number; percent: number; total: number}[];
    name: string;
}
---

<div class="flex max-h-full w-110 flex-col rounded-lg bg-compat-card p-4 border-border border-2">
    <!-- Header -->
    <div class="flex flex-row gap-x-4 border-b border-border pb-4">
        <slot name="icon" />
        <div class="flex flex-col">
            <span class="text-xl font-normal text-gray-600 dark:text-white">{name}</span>
            <span class="text-sm font-normal text-gray-600 dark:text-gray-300">Tested games: {osStart[0]['total']}</span>
        </div>
    </div>
    <!-- Chart -->
    <div class="mt-4 flex flex-col gap-3 overflow-y-auto pr-1">
        {
            osStart.map(({tag, count, percent, total}) => {
                const widthPct = (count / total) * 100;
                const barColor = statusStyles[tag] ?? 'bg-gray-500';

                return (
                    <div class="flex flex-col gap-1">
                        <div class="flex items-baseline justify-between">
                            <span class="text-sm text-gray-700 dark:text-gray-200">{tag}</span>
                            <span class="text-xs tabular-nums text-gray-600 dark:text-gray-300">
                                {count} â€¢ {percent.toFixed(2)}%
                            </span>
                        </div>

                        {/* Accessible progress bar */}
                        <div
                            class="h-3 w-full overflow-hidden rounded-full bg-gray-200/70 dark:bg-white/10"
                            role="progressbar"
                            aria-label={`${tag} games`}
                            aria-valuemin={0}
                            aria-valuenow={Math.round(widthPct)}
                            aria-valuemax={100}
                            title={`${count} games (${percent.toFixed(2)}%)`}
                        >
                            <div class={`h-full ${barColor} rounded-full`} style={{width: `${widthPct}%`}} />
                        </div>
                    </div>
                );
            })
        }
    </div>
</div>
